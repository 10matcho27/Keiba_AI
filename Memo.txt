三連複で利益を狙う場合、各レースの各馬について「その馬がトップ3に入るかどうか」を予測する二値分類モデルを作成するのが一般的なアプローチです。以下に、用意されたデータをどのように使ってXGBoostでモデルを構築するか、具体的な流れを示します。
1. ターゲット変数の作成

    ラベル付け
    各レースの各馬に対して、最終的な着順の情報（例：1, 2, 3, …）があるので、
        1～3位の場合 → 1（トップ3入り）
        4位以降の場合 → 0（トップ3外）
        といった形で二値のターゲット変数を作成します。

2. 特徴量の抽出とエンジニアリング

    基本特徴量
    用意された各列（馬番、騎手、斤量、タイム、人気、オッズ、馬体重の変化、レース条件など）をそのまま使える数値データとして利用します。

    カテゴリ変数のエンコーディング
    たとえば、
        性別・年齢（牝3、牡3など）
        騎手、調教師
        天候、馬場状態
        レースの距離やコース（例：ダ1200m (右)）
        など、文字列になっている情報はワンホットエンコーディングやラベルエンコーディングを利用して数値化します。

    追加特徴量の作成
    可能であれば、過去の成績や直近のレースでのパフォーマンス、同条件下での実績など、履歴データから派生する特徴量を作成すると、モデルがより的確な予測を行いやすくなります。

    数値変換と前処理
    時刻や日付は適切なフォーマットに変換し、タイム（例：1:15.0）は秒数に変換するなど、数値データとして扱いやすい形に整えます。また、欠損値があれば補完や除外などの処理を行います。

3. データセットの作成と分割

    行単位のデータ
    各行は「あるレースの中の1頭の馬」として扱います。ターゲット変数（トップ3入りか否か）と特徴量が整った状態にします。

    時系列／レース単位の分割
    過去のレース結果を利用して学習する場合、未来の情報が混入しないように、時系列に沿って学習用データ、検証用データ、テスト用データに分割します。
    たとえば、2020～2023年分を学習データ、2024年分を検証、2025年分をテストとする方法が考えられます。
    ※ レース単位で分割することで、同じレース内の馬同士の相互依存関係を適切に扱います。

4. XGBoostモデルの構築と学習

    モデルの選定
    XGBoostの分類モデル（例えば、XGBClassifier）を用いて、各馬がトップ3入りするか否かを予測します。

    ハイパーパラメータのチューニング
    交差検証（特に時系列やレース単位のグループ分割を考慮した方法）を用いて、
        学習率
        木の深さ
        正則化パラメータ（L1、L2）
        scale_pos_weight（トップ3入りの馬は全体の中で少数であるため、不均衡データに対処するためのパラメータ）
        などのハイパーパラメータを最適化します。

    学習
    前処理された特徴量とターゲット変数を用いてXGBoostで学習を行い、モデルが各馬の「トップ3入り確率」を出力できるようにします。

5. 予測と三連複の戦略

    予測確率の算出
    学習済みモデルを用いて、新たなレースに出走する各馬のトップ3入りの確率を予測します。

    予測結果の利用
    各レースで、予測確率が高い上位3頭を選定します。
    これをそのまま「三連複の予想組み合わせ」として利用するか、もしくは複数候補を組み合わせた馬券戦略（例：軸馬を決めた複数の組み合わせ）を検討するとよいでしょう。

    シミュレーションによる検証
    仮想ベッティングシミュレーションを通して、実際の収益性（ROIなど）を評価し、モデルの予測と馬券戦略の両面から有用性を検証します。

まとめ

    ターゲットの設定
    各レースの各馬に「トップ3入り（1）／トップ3外（0）」のラベルを作成。

    特徴量の整備
    用意されたレース結果から数値データ、カテゴリ変数を整形し、必要ならば追加の特徴量も作成する。

    データの前処理と分割
    時系列やレース単位を意識して学習・検証データに分割し、リークを防止する。

    XGBoostで学習
    不均衡データへの対応やハイパーパラメータの調整を行い、各馬のトップ3入り確率を予測する分類モデルを構築する。

    予測結果の活用
    各レースで予測確率が高い上位3頭を選定し、三連複の馬券戦略として利用する。

この流れに沿って、用意されたデータを最大限に活用し、XGBoostによる予測モデルを構築すれば、三連複での採算性の高い馬券戦略に結び付けやすくなります。